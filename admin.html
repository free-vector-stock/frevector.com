<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FREE VECTOR STOCK - Batch Cloud Admin</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 40px; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1a1a1a; margin-bottom: 30px; }
        input[type="password"] { width: 100%; padding: 15px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .drop-area { border: 3px dashed #000; padding: 60px; text-align: center; background: #fafafa; border-radius: 12px; cursor: pointer; transition: 0.3s; margin-bottom: 20px; }
        .drop-area:hover { background: #f0f0f0; border-color: #555; }
        #log { background: #1e1e1e; color: #00ff00; padding: 20px; border-radius: 8px; height: 250px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 13px; margin-top: 20px; }
        .btn-upload { background: #000; color: #fff; width: 100%; padding: 20px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-upload:disabled { background: #888; cursor: not-allowed; }
        .file-info { text-align: center; margin-bottom: 15px; font-weight: bold; color: #444; }
    </style>
</head>
<body>

<div class="container">
    <h1>BATCH CLOUD UPLOADER</h1>
    <input type="password" id="token" placeholder="Enter GitHub Personal Access Token">
    
    <div class="drop-area" id="dropArea" onclick="document.getElementById('fileInput').click()">
        <strong>Click or Drag Files Here</strong>
        <p>Supports JPG, EPS, SVG, JSON</p>
    </div>
    <input type="file" id="fileInput" multiple style="display:none" onchange="handleFiles()">
    
    <div class="file-info" id="fileCount">No files selected</div>
    
    <button class="btn-upload" id="upBtn" onclick="startDeployment()">DEPLOY TO CLOUD</button>
    
    <div id="log">Ready to process...</div>
</div>

<script>
    const REPO_OWNER = "free-vector-stock";
    const REPO_NAME = "free-vector-stock";
    let selectedFiles = [];

    function handleFiles() {
        selectedFiles = Array.from(document.getElementById('fileInput').files);
        document.getElementById('fileCount').innerText = `${selectedFiles.length} files ready for upload.`;
    }

    function addLog(msg) {
        const l = document.getElementById('log');
        l.innerHTML += `> ${msg}<br>`;
        l.scrollTop = l.scrollHeight;
    }

    async function startDeployment() {
        const token = document.getElementById('token').value;
        if(!token || selectedFiles.length === 0) return alert("Please provide token and select files!");

        const btn = document.getElementById('upBtn');
        btn.disabled = true;
        addLog("Starting batch deployment...");

        try {
            // 1. Get current commit SHA
            const refRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/git/refs/heads/main`, {
                headers: { 'Authorization': `token ${token}` }
            });
            const refData = await refRes.json();
            const baseSha = refData.object.sha;

            // 2. Create Blobs for each file
            addLog(`Creating blobs for ${selectedFiles.length} files...`);
            const treeEntries = [];
            
            for (let file of selectedFiles) {
                const base64 = await toBase64(file);
                const blobRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/git/blobs`, {
                    method: 'POST',
                    headers: { 'Authorization': `token ${token}` },
                    body: JSON.stringify({ content: base64, encoding: 'base64' })
                });
                const blobData = await blobRes.json();
                
                treeEntries.push({
                    path: `assets/${file.name}`,
                    mode: "100644",
                    type: "blob",
                    sha: blobData.sha
                });
                addLog(`Blob created: ${file.name}`);
            }

            // 3. Create a New Tree
            addLog("Building virtual git tree...");
            const treeRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/git/trees`, {
                method: 'POST',
                headers: { 'Authorization': `token ${token}` },
                body: JSON.stringify({ base_tree: baseSha, tree: treeEntries })
            });
            const treeData = await treeRes.json();

            // 4. Create the Commit
            addLog("Committing changes...");
            const commitRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/git/commits`, {
                method: 'POST',
                headers: { 'Authorization': `token ${token}` },
                body: JSON.stringify({
                    message: `Admin: Batch upload ${selectedFiles.length} assets`,
                    tree: treeData.sha,
                    parents: [baseSha]
                })
            });
            const commitData = await commitRes.json();

            // 5. Update the main branch
            addLog("Pushing to main branch...");
            await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/git/refs/heads/main`, {
                method: 'PATCH',
                headers: { 'Authorization': `token ${token}` },
                body: JSON.stringify({ sha: commitData.sha })
            });

            addLog("SUCCESS! All files uploaded in a single commit.");
            addLog("GitHub Pages will update in 1-2 minutes.");
        } catch (err) {
            addLog("CRITICAL ERROR: " + err.message);
        }
        btn.disabled = false;
    }

    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
    });
</script>
</body>
</html>
