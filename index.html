<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Vector Admin | Free Vector Stock</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .upload-box { background: #111; padding: 40px; border-radius: 20px; border: 2px solid #f39c12; width: 500px; text-align: center; box-shadow: 0 0 20px rgba(243, 156, 18, 0.2); }
        h2 { color: #f39c12; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 1px; }
        .info { font-size: 13px; color: #777; margin-bottom: 25px; line-height: 1.5; }
        input[type="password"] { width: 100%; padding: 14px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #222; color: white; box-sizing: border-box; outline: none; }
        input[type="password"]:focus { border-color: #f39c12; }
        .btn-select { background: #222; color: #f39c12; padding: 12px; border-radius: 8px; cursor: pointer; display: block; margin: 15px 0; border: 1px dashed #f39c12; width: 100%; font-weight: bold; transition: 0.3s; }
        .btn-select:hover { background: #f39c12; color: #000; }
        .btn-upload { background: #27ae60; color: #fff; padding: 16px; border-radius: 8px; font-weight: bold; cursor: pointer; border: none; width: 100%; font-size: 16px; margin-top: 10px; transition: 0.3s; }
        .btn-upload:hover { background: #2ecc71; transform: translateY(-2px); }
        #log { margin-top: 20px; font-size: 13px; text-align: left; max-height: 200px; overflow-y: auto; color: #aaa; border-top: 1px solid #222; padding-top: 15px; font-family: monospace; }
        .status-msg { color: #f39c12; font-weight: bold; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

<div class="upload-box">
    <h2>Bulk Vector Admin</h2>
    <p class="info">Each JPG filename will automatically become the folder and asset name on your site.</p>
    
    <input type="password" id="ghToken" placeholder="Paste GitHub Token (ghp_...)">
    
    <input type="file" id="fileInput" multiple accept=".jpg,.jpeg,.eps" style="display: none;" onchange="updateList()">
    <button class="btn-select" onclick="document.getElementById('fileInput').click()">Select JPG & EPS Files Together</button>
    
    <span id="fileCount" class="status-msg"></span>
    
    <button class="btn-upload" onclick="startBulkUpload()">START AUTO-UPLOAD</button>
    
    <div id="log"></div>
</div>

<script>
    function updateList() {
        const files = document.getElementById('fileInput').files;
        document.getElementById('fileCount').innerText = files.length + " files ready for processing.";
    }

    async function startBulkUpload() {
        const token = document.getElementById('ghToken').value;
        const files = Array.from(document.getElementById('fileInput').files);
        const log = document.getElementById('log');

        if (!token || files.length === 0) {
            alert("Please provide your GitHub Token and select files first.");
            return;
        }

        log.innerHTML = "üöÄ Starting bulk upload process...";

        // Group files by their base name (e.g., "pizza-clock")
        const jpgFiles = files.filter(f => f.name.toLowerCase().endsWith('.jpg') || f.name.toLowerCase().endsWith('.jpeg'));

        for (let jpgFile of jpgFiles) {
            const baseName = jpgFile.name.split('.')[0]; 
            const safeFolderName = baseName.toLowerCase().replace(/\s+/g, '-');
            
            // Find the matching EPS file for this JPG
            const epsFile = files.find(f => f.name.split('.')[0] === baseName && f.name.toLowerCase().endsWith('.eps'));

            if (epsFile) {
                log.innerHTML += `<br>üìÅ Processing Folder: <b>${safeFolderName}</b>`;
                
                const jpgSuccess = await uploadFile(jpgFile, safeFolderName, token);
                const epsSuccess = await uploadFile(epsFile, safeFolderName, token);
                
                if(jpgSuccess && epsSuccess) {
                    log.innerHTML += ` - <span style="color:#2ecc71">‚úÖ Success</span>`;
                } else {
                    log.innerHTML += ` - <span style="color:#e74c3c">‚ùå Failed</span>`;
                }
            } else {
                log.innerHTML += `<br>‚ö†Ô∏è <span style="color:#f1c40f">Skipped:</span> Missing EPS for "${baseName}"`;
            }
        }
        log.innerHTML += `<br><br>üèÅ <b>Bulk Process Finished!</b>`;
    }

    async function uploadFile(file, folder, token) {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        return new Promise(resolve => {
            reader.onload = async () => {
                const content = reader.result.split(',')[1];
                const path = `vectors/${folder}/${file.name}`;
                
                try {
                    const response = await fetch(`https://api.github.com/repos/free-vector-stock/free-vector-stock/contents/${path}`, {
                        method: 'PUT',
                        headers: { 'Authorization': `token ${token}` },
                        body: JSON.stringify({ message: `Bulk Auto-Upload: ${folder}`, content: content })
                    });
                    resolve(response.ok);
                } catch (e) { 
                    console.error(e);
                    resolve(false);
                }
            };
        });
    }
</script>
</body>
</html>
